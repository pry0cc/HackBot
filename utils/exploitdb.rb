class ExploitDB
    def initialize(exploit_csv="exploitdb/files_exploits.csv", shellcode_csv="exploitdb/files_shellcodes.csv")
        @exploit_data = []
        @shellcodes_data = []

        @exploit_raw = CSV.read(exploit_csv)
        @exploit_raw.each do |exploit|
            ed = {}
            ed["id"], ed["path"], ed["title"], ed["date"], ed["author"], ed["category"], ed["type"], ed["platform"], ed["port"] = exploit
            @exploit_data.push(ed)
        end

        @shellcodes_raw = CSV.read(shellcode_csv)
        @shellcodes_raw.each do |shellcode|
            sc = {}
            sc["id"], sc["file"], sc["description"], sc["date"], sc["author"], sc["type"], sc["platform"] = shellcode
            @shellcodes_data.push(sc)
        end
    end

    def search_exploits(query)
        return @exploit_data.select { |exploit| 
            exploit["id"].include? query or 
            exploit["title"].include? query or
            exploit["date"].include? query or
            exploit["author"].include? query
        }
    end

    def search_shellcodes(query)
        return @shellcodes_data.select { |shellcode| 
            shellcode["id"].include? query or 
            shellcode["file"].include? query or
            shellcode["description"].include? query or
            shellcode["date"].include? query or
            shellcode["author"].include? query
        }
    end

    def get_file(id, path="./")
        res = @exploit_data.select {|exploit| exploit["id"] == id}
        if res.length > 0
            filename = res[0]["path"]
            return File.open("#{path}/#{filename}", "r")
        end
        
        res =  @shellcodes_data.select {|shellcode| shellcode["id"] == id}
        if res.length > 0
            filename = res[0]["file"]
            return File.open("#{path}/#{filename}", "r")
        end
    end
end

# exploitdb = ExploitDB.new()
# puts exploitdb.search_shellcodes("linux")
# puts exploitdb.get_file("46039").read()